(this["webpackJsonpqueue-management"]=this["webpackJsonpqueue-management"]||[]).push([[0],{38:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(3),c=n.n(a),s=n(31),i=n.n(s),u=(n(38),n(14));n(49);function o(){return Object(r.jsxs)("div",{className:"operation-buttons",children:[Object(r.jsx)(u.b,{to:"/queue-management/reservation",children:"CUSTOMER"}),Object(r.jsx)(u.b,{to:"/queue-management/current-customer",children:"CURRENT CUSTOMER"}),Object(r.jsx)(u.b,{to:"/queue-management/signin",children:"SPECIALIST"})]})}var l=n(5),j=n.n(l),d=n(10),b=n(11),f=n(21);n(45),n(46);f.a.initializeApp({apiKey:"AIzaSyDy1NHxSsz2auiR6JwdVRQAOb5m82mkNrA",authDomain:"queue-management-a8696.firebaseapp.com",projectId:"queue-management-a8696",storageBucket:"queue-management-a8696.appspot.com",messagingSenderId:"881909944130",appId:"1:881909944130:web:7aea2aa9dd66def12442db",measurementId:"G-M22GWEZV19"});var h=f.a.auth(),p=f.a.database(),m=(f.a,c.a.createContext()),O=function(){return Object(a.useContext)(m)};function x(e){var t=e.children,n=Object(a.useState)(),c=Object(b.a)(n,2),s=c[0],i=c[1];Object(a.useEffect)((function(){return h.onAuthStateChanged((function(e){i(e)}))}),[]);var u={currentUser:s,signIn:function(e,t){return h.signInWithEmailAndPassword(e,t)},logOut:function(){return h.signOut()}};return Object(r.jsx)(m.Provider,{value:u,children:t})}var v=n(9);function g(){var e=Object(a.useRef)(null),t=Object(a.useRef)(null),n=O().signIn,c=Object(v.f)(),s=function(){var r=Object(d.a)(j.a.mark((function r(a){var s,i;return j.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.preventDefault(),s=e.current.value,i=t.current.value,r.prev=3,r.next=6,n(s,i);case 6:c.push("/queue-management/"),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(3),console.log(r.t0.message);case 12:case"end":return r.stop()}}),r,null,[[3,9]])})));return function(e){return r.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"login-container",children:[Object(r.jsxs)("form",{children:[Object(r.jsx)("label",{children:"Mail : "}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{ref:e,type:"text"}),Object(r.jsx)("br",{}),Object(r.jsx)("label",{children:"Password : "}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{ref:t,type:"text"}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"submit",onClick:s,value:"Login"})]}),Object(r.jsx)(u.b,{to:"/queue-management/",children:"Back"})]})}var k=c.a.createContext(),C=function(){return Object(a.useContext)(k)};function y(e){var t=e.children,n=Object(a.useState)(),c=Object(b.a)(n,2),s=c[0],i=c[1],u=Object(a.useState)(!0),o=Object(b.a)(u,2),l=o[0],f=o[1],h=Object(a.useState)(),m=Object(b.a)(h,2),O=m[0],x=m[1],g=Object(a.useState)(),C=Object(b.a)(g,2),y=C[0],w=C[1],D=Object(a.useState)(),S=Object(b.a)(D,2),q=S[0],N=S[1],P=(Object(v.f)(),function(){p.ref("/specialists").on("value",(function(e){var t=e.val(),n=[];for(var r in t)n.push(t[r]);f(!1),w(n)}))}),E={reservation:function(e,t){var n=p.ref("reservations");p.ref("/reservations/counter").transaction((function(e){return null===e?1:"number"===typeof e?e+1:void console.log("Not a number")})).then((function(r){var a=r.snapshot.node_.value_,c=n.push().getKey(),s=new Date,i={name:t,specialist:e,token:a,status:"incoming",reservationCode:c,timestamp:s.getTime()};n.child(c).set(i).then((function(){N(c)}))}))},fetchUserData:function(e){p.ref("/reservations").on("value",(function(t){if(t.child(e).exists()){var n=t.child(e).val();i(n),P()}else console.log("dont exist"),f(!1)}))},fetchDisplay:P,fetchIncomingVisits:function(){p.ref("/reservations").orderByChild("status").equalTo("incoming").limitToFirst(5).on("value",(function(e){var t=e.val(),n=[];for(var r in t)n.push(t[r]);x(n)}))},cancelMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t,n,r){var a,c,s,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.ref("reservations/"+t);case 2:return a=e.sent,e.next=5,a.update({status:"canceled"});case 5:return e.next=7,a.remove();case 7:if(!(c=n.find((function(e){return e.currentPatient.token===r})))){e.next=15;break}return s=c.id,e.next=12,p.ref("specialists/"+s+"/currentPatient");case 12:return i=e.sent,e.next=15,i.update({status:"",token:"",name:""});case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),reservationCode:q,userData:s,incomingVisits:O,queueData:y,loading:l};return Object(r.jsx)(k.Provider,{value:E,children:t})}function w(){var e=Object(a.useState)(!1),t=Object(b.a)(e,2),n=t[0],c=t[1],s=C(),i=s.reservation,o=s.reservationCode,l=Object(v.f)(),f=Object(a.useRef)(),h=Object(a.useRef)(),p=function(){var e=Object(d.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=f.current.value,r=h.current.value,e.prev=3,e.next=6,i(n,r);case 6:c(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.log(e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}();return n&&o?Object(r.jsxs)("div",{className:"reservation-container",children:[Object(r.jsxs)("h1",{children:["PLEASE SAVE YOUR RESERVATION CODE : ",o]}),Object(r.jsx)("button",{onClick:function(e){e.preventDefault(),l.push("/queue-management/display/".concat(o))},children:"Proceed"})]}):Object(r.jsx)("div",{className:"reservation-container",children:Object(r.jsxs)("form",{children:[Object(r.jsx)("label",{children:"Choose a specialist : "}),Object(r.jsx)("br",{}),Object(r.jsxs)("select",{ref:f,name:"specialists",children:[Object(r.jsx)("option",{value:"cardiologist",children:"Cardiologist"}),Object(r.jsx)("option",{value:"psychiatrist",children:"Psychiatrist"}),Object(r.jsx)("option",{value:"allergist",children:"Allergist"}),Object(r.jsx)("option",{value:"orthodontist",children:"Orthodontist"})]}),Object(r.jsx)("br",{}),Object(r.jsx)("label",{children:"Your Name"}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{ref:h,type:"text"}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)(u.b,{to:"/queue-management/",children:"Back"}),Object(r.jsx)("input",{type:"submit",onClick:p,value:"Reserve"})]})})}var D=c.a.createContext(),S=function(){return Object(a.useContext)(D)};function q(e){var t=e.children,n=Object(a.useState)(),c=Object(b.a)(n,2),s=c[0],i=c[1],u=function(e){var t=e.role;p.ref("reservations").orderByChild("specialist").equalTo(t).on("value",(function(t){var n=t.val(),r=[];for(var a in n)r.push(n[a]);r.sort((function(e,t){return e.timestamp-t.timestamp})),i({specialistInfo:e,customers:r})}))},o={specialistData:s,fetchSpecialist:function(){var e=h.currentUser.uid;p.ref("specialists/"+e).on("value",(function(e){var t=e.val();u(t)}))},fetchCustomers:u,callMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t,n,r){var a,c,s,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.currentUser.uid,e.next=3,p.ref("display/"+a);case 3:return c=e.sent,e.next=6,p.ref("specialists/"+a);case 6:return s=e.sent,e.next=9,p.ref("reservations/"+n);case 9:return i=e.sent,e.next=12,c.update({token:t});case 12:return e.next=14,i.update({status:"called"});case 14:return e.next=16,s.update({currentPatient:{name:r,token:t,status:"called"}});case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),startMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t){var n,r,a,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.currentUser.uid,r=new Date,e.next=4,p.ref("reservations/"+t);case 4:return a=e.sent,e.next=7,p.ref("specialists/"+n+"/currentPatient");case 7:return c=e.sent,e.next=10,a.update({status:"started",meetingStartTime:r.getTime()});case 10:return e.next=12,c.update({status:"started"});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),endMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t){var n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.currentUser.uid,e.next=3,p.ref("reservations/"+t);case 3:return r=e.sent,e.next=6,p.ref("specialists/"+n+"/currentPatient");case 6:return a=e.sent,e.next=9,r.update({status:"ended"});case 9:return e.next=11,r.remove();case 11:return e.next=13,a.update({status:"",token:"",name:""});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),cancelMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t,n,r){var a,c,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.currentUser.uid,e.next=3,p.ref("reservations/"+t);case 3:return c=e.sent,e.next=6,p.ref("specialists/"+a+"/currentPatient");case 6:return s=e.sent,e.next=9,c.update({status:"canceled"});case 9:return e.next=11,c.remove();case 11:if(r!==n){e.next=14;break}return e.next=14,s.update({status:"",token:"",name:""});case 14:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()};return Object(r.jsx)(D.Provider,{value:o,children:t})}function N(){var e=O().logOut,t=S(),n=t.fetchSpecialist,c=t.specialistData,s=t.callMeeting,i=t.startMeeting,u=t.endMeeting,o=t.cancelMeeting,l=Object(v.f)();Object(a.useEffect)((function(){n()}),[]);var b=function(){var t=Object(d.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:l.push("/queue-management/"),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0.message);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}();if(!c)return Object(r.jsx)("div",{children:"Loading..."});console.log(c);var f=c.specialistInfo,h=c.specialistInfo.currentPatient;return Object(r.jsxs)("div",{className:"dashboard-container",children:[Object(r.jsx)("h1",{children:"DashBoard"}),Object(r.jsxs)("h1",{children:["Specialist : ",f.role]}),Object(r.jsxs)("p",{children:["Current patient: ",h.name]}),Object(r.jsxs)("p",{children:["Patient token: ",h.token]}),Object(r.jsxs)("p",{children:["Status: ",h.status]}),Object(r.jsx)("div",{className:"customer-container",children:c.customers.map((function(e,t){return Object(r.jsxs)("div",{className:"customer",children:[Object(r.jsx)("p",{children:e.token}),Object(r.jsx)("p",{children:e.name}),Object(r.jsx)("button",{className:0===t&&""===h.token?"allow":"restrict",onClick:function(){return s(e.token,e.reservationCode,e.name)},children:"Call"}),Object(r.jsx)("button",{className:h.token===e.token&&"called"===h.status?"allow":"restrict",onClick:function(){return i(e.reservationCode)},children:"Start meeting"}),Object(r.jsx)("button",{className:h.token===e.token&&"started"===h.status?"allow":"restrict",onClick:function(){return u(e.reservationCode)},children:"End meeting"}),Object(r.jsx)("button",{className:"cancel",onClick:function(){return o(e.reservationCode,e.token,h.token)},children:"Cancel meeting"})]},t)}))}),Object(r.jsx)("button",{onClick:b,children:"Log Out"})]})}function P(e){var t=e.queueData;return Object(r.jsx)(r.Fragment,{children:t.map((function(e,t){return Object(r.jsxs)("h1",{children:[e.desk," ----",">"," ",e.currentPatient.token]},t)}))})}function E(e){var t=e.incomingVisits;return console.log("yes"),Object(r.jsx)(r.Fragment,{children:t.map((function(e,t){return Object(r.jsx)("h1",{children:e.token},t)}))})}function I(e){var t=e.userData,n=Object(a.useState)(),c=Object(b.a)(n,2),s=c[0],i=c[1],u=Object(a.useState)(!1),o=Object(b.a)(u,2),l=o[0],f=o[1],h=S(),p=h.fetchCustomers,m=h.specialistData,O=Object(a.useState)(),x=Object(b.a)(O,2),v=x[0],g=x[1],k=Object(a.useState)(),C=Object(b.a)(k,2),y=C[0],w=C[1];if(Object(a.useEffect)((function(){(function(){var e=Object(d.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p({role:t.specialist});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(a.useEffect)((function(){m&&D()}),[m]),Object(a.useEffect)((function(){if(l){if(y<0)return g(v-1),void w(59);0===v&&0===y&&(w(0),g(10*(s-1)),f(!1));var e=setInterval((function(){w(y-1)}),1e3);return function(){return clearInterval(e)}}}),[y,l]),!m)return Object(r.jsx)("div",{className:"queue-container",children:Object(r.jsx)("h1",{children:"Loading..."})});var D=function(){var e,n=m.customers;n.forEach((function(n,r){t.reservationCode===n.reservationCode&&(e=r)})),i(e);var r=n[0].meetingStartTime;if(r){var a=new Date(r),c=new Date(a);c.setMinutes(a.getMinutes()+10);var s=(new Date).getTime();if(s>c.getTime())console.log("Time already passed, current meeting is longer than 10 minutes"),w(0),g(10*e),f(!1);else{var u=c.getTime()-s,o=Math.floor(u%36e5/6e4),l=Math.floor(u%6e4/1e3);console.log("minutes : "+o),console.log("seconds : "+l),w(l),g(o),f(!0)}}else w(0),g(10*e),f(!1)};return Object(r.jsxs)("div",{className:"queue-container",children:[Object(r.jsxs)("h1",{children:["Your're ",s+1,"th in the queue"]}),Object(r.jsx)("h1",{children:"Queue waiting time"}),l?0===s?Object(r.jsx)("p",{children:"00:00"}):Object(r.jsxs)("p",{children:[v+10*(s-1),":",y]}):Object(r.jsxs)("p",{children:[v," : ",y]})]})}function M(e){var t,n=Object(a.useState)(!1),c=Object(b.a)(n,2),s=c[0],i=c[1],u=e.match.params.id,o=C(),l=o.fetchUserData,f=o.userData,h=o.queueData,p=o.fetchIncomingVisits,m=o.loading,O=o.incomingVisits,x=o.cancelMeeting;return Object(a.useEffect)((function(){(function(){var e=Object(d.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(u);case 2:return e.next=4,p();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),!m&&h&&O?f?"ended"===f.status?Object(r.jsx)("div",{className:"customerDashboard-container",children:Object(r.jsx)("h1",{children:"A meeting has been ended, have a nice day!"})}):"canceled"===f.status?Object(r.jsx)("div",{className:"customerDashboard-container",children:Object(r.jsx)("h1",{children:"A meeting has been canceled"})}):(t=s?Object(r.jsx)(I,{userData:f}):Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("p",{children:["Hello ",f.name,", Your token : ",f.token]}),"called"===f.status&&Object(r.jsx)("p",{children:"Your turn is up, please proceede to the counter"}),"started"===f.status&&Object(r.jsx)("p",{children:"A meeting have been started"}),Object(r.jsx)("button",{onClick:function(){return x(f.reservationCode,h,f.token)},children:"Cancel visit"}),Object(r.jsxs)("div",{className:"display",children:[Object(r.jsx)("div",{className:"current-visits",children:Object(r.jsx)(P,{queueData:h})}),Object(r.jsx)("div",{className:"incoming-visits",children:Object(r.jsx)(E,{incomingVisits:O})})]})]}),Object(r.jsxs)("div",{className:"customerDashboard-container",children:[Object(r.jsx)("h1",{children:"customerDashboard"}),Object(r.jsx)("button",{onClick:function(){return i(!1)},children:"Display"}),Object(r.jsx)("button",{onClick:function(){return i(!0)},children:"Queue time"}),t]})):Object(r.jsx)("div",{className:"customerDashboard-container",children:Object(r.jsx)("h1",{children:"Page is don't exist"})}):Object(r.jsx)("div",{className:"customerDashboard-container",children:Object(r.jsx)("h1",{children:"Loading..."})})}function T(){var e=Object(a.useRef)(null),t=Object(v.f)(),n=function(){var n=Object(d.a)(j.a.mark((function n(r){var a;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r.preventDefault(),a=e.current.value,t.push("/queue-management/display/".concat(a));case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"login-container",children:[Object(r.jsxs)("form",{children:[Object(r.jsx)("label",{children:"Reservation Code : "}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{ref:e,type:"text"}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"submit",onClick:n,value:"Proceed"})]}),Object(r.jsx)(u.b,{to:"/queue-management/",children:"Back"})]})}function R(){return Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("h1",{children:"404! Page not found"})})}n(47);var A=function(){var e,t=O().currentUser;return t?e=Object(r.jsxs)(v.c,{children:[Object(r.jsx)(v.a,{exact:!0,path:"/queue-management",component:N}),Object(r.jsx)(v.a,{path:"/queue-management/display/:id",component:M}),Object(r.jsx)(v.a,{path:"/queue-management/reservation",component:w}),Object(r.jsx)(v.a,{component:R})]}):null===t&&(e=Object(r.jsxs)(v.c,{children:[Object(r.jsx)(v.a,{exact:!0,path:"/queue-management",component:o}),Object(r.jsx)(v.a,{path:"/queue-management/signin",component:g}),Object(r.jsx)(v.a,{path:"/queue-management/display/:id",component:M}),Object(r.jsx)(v.a,{path:"/queue-management/reservation",component:w}),Object(r.jsx)(v.a,{path:"/queue-management/current-customer",component:T}),Object(r.jsx)(v.a,{component:R})]})),Object(r.jsx)("div",{className:"App",children:Object(r.jsxs)("div",{className:"main-container",children:[Object(r.jsx)("h1",{children:"Queue Management System"}),e]})})},U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,50)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))};i.a.render(Object(r.jsx)(u.a,{children:Object(r.jsx)(x,{children:Object(r.jsx)(q,{children:Object(r.jsx)(y,{children:Object(r.jsx)(A,{})})})})}),document.getElementById("root")),U()}},[[48,1,2]]]);
//# sourceMappingURL=main.fda37b3d.chunk.js.map