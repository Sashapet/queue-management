(this["webpackJsonpqueue-management"]=this["webpackJsonpqueue-management"]||[]).push([[0],{38:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n(3),a=n.n(c),s=n(31),i=n.n(s),u=(n(38),n(16));n(49);function o(){return Object(r.jsxs)("div",{className:"operation-buttons",children:[Object(r.jsx)(u.b,{to:"/reservation",children:"CUSTOMER"}),Object(r.jsx)(u.b,{to:"/signin",children:"SPECIALIST"})]})}var l=n(7),j=n.n(l),d=n(11),b=n(13),f=n(21);n(45),n(46);f.a.initializeApp({apiKey:"AIzaSyDy1NHxSsz2auiR6JwdVRQAOb5m82mkNrA",authDomain:"queue-management-a8696.firebaseapp.com",projectId:"queue-management-a8696",storageBucket:"queue-management-a8696.appspot.com",messagingSenderId:"881909944130",appId:"1:881909944130:web:7aea2aa9dd66def12442db",measurementId:"G-M22GWEZV19"});var h=f.a.auth(),p=f.a.database(),x=(f.a,a.a.createContext()),O=function(){return Object(c.useContext)(x)};function v(e){var t=e.children,n=Object(c.useState)(),a=Object(b.a)(n,2),s=a[0],i=a[1];Object(c.useEffect)((function(){return h.onAuthStateChanged((function(e){i(e)}))}),[]);var u={currentUser:s,signIn:function(e,t){return h.signInWithEmailAndPassword(e,t)},logOut:function(){return h.signOut()}};return Object(r.jsx)(x.Provider,{value:u,children:t})}var m=n(9);function g(){var e=Object(c.useRef)(null),t=Object(c.useRef)(null),n=O().signIn,a=Object(m.f)(),s=function(){var r=Object(d.a)(j.a.mark((function r(c){var s,i;return j.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c.preventDefault(),s=e.current.value,i=t.current.value,r.prev=3,r.next=6,n(s,i);case 6:a.push("/"),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(3),console.log(r.t0.message);case 12:case"end":return r.stop()}}),r,null,[[3,9]])})));return function(e){return r.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"login-container",children:[Object(r.jsxs)("form",{children:[Object(r.jsx)("label",{children:"Mail : "}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{ref:e,type:"text"}),Object(r.jsx)("br",{}),Object(r.jsx)("label",{children:"Password : "}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{ref:t,type:"text"}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"submit",onClick:s,value:"Login"})]}),Object(r.jsx)(u.b,{to:"/",children:"Back"})]})}var k=a.a.createContext(),C=function(){return Object(c.useContext)(k)};function y(e){var t=e.children,n=Object(c.useState)(),a=Object(b.a)(n,2),s=a[0],i=a[1],u=Object(c.useState)(!0),o=Object(b.a)(u,2),l=o[0],f=o[1],h=Object(c.useState)(),x=Object(b.a)(h,2),O=x[0],v=x[1],g=Object(c.useState)(),C=Object(b.a)(g,2),y=C[0],w=C[1],D=Object(m.f)(),S=function(){p.ref("/specialists").on("value",(function(e){var t=e.val(),n=[];for(var r in t)n.push(t[r]);f(!1),w(n)}))},N={reservation:function(e,t){var n=p.ref("reservations");p.ref("/reservations/counter").transaction((function(e){return null===e?1:"number"===typeof e?e+1:void console.log("Not a number")})).then((function(r){var c=r.snapshot.node_.value_,a=n.push().getKey(),s=new Date,i={name:t,specialist:e,token:c,status:"incoming",reservationCode:a,timestamp:s.getTime()};n.child(a).set(i).then((function(){D.push("/display/".concat(a))}))}))},fetchUserData:function(e){p.ref("/reservations").on("value",(function(t){if(t.child(e).exists()){var n=t.child(e).val();i(n),S()}else console.log("dont exist"),f(!1)}))},fetchDisplay:S,fetchIncomingVisits:function(){p.ref("/reservations").orderByChild("status").equalTo("incoming").limitToFirst(5).on("value",(function(e){var t=e.val(),n=[];for(var r in t)n.push(t[r]);v(n)}))},cancelMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t,n,r){var c,a,s,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.ref("reservations/"+t);case 2:return c=e.sent,e.next=5,c.update({status:"canceled"});case 5:return e.next=7,c.remove();case 7:if(!(a=n.find((function(e){return e.currentPatient.token===r})))){e.next=15;break}return s=a.id,e.next=12,p.ref("specialists/"+s+"/currentPatient");case 12:return i=e.sent,e.next=15,i.update({status:"",token:"",name:""});case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),userData:s,incomingVisits:O,queueData:y,loading:l};return Object(r.jsx)(k.Provider,{value:N,children:t})}function w(){var e=C().reservation,t=Object(c.useRef)(),n=Object(c.useRef)(),a=function(){var r=Object(d.a)(j.a.mark((function r(c){var a,s;return j.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c.preventDefault(),a=t.current.value,s=n.current.value,r.next=5,e(a,s);case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();return Object(r.jsx)("div",{className:"reservation-container",children:Object(r.jsxs)("form",{children:[Object(r.jsx)("label",{children:"Choose a specialist : "}),Object(r.jsx)("br",{}),Object(r.jsxs)("select",{ref:t,name:"specialists",children:[Object(r.jsx)("option",{value:"cardiologist",children:"Cardiologist"}),Object(r.jsx)("option",{value:"psychiatrist",children:"Psychiatrist"}),Object(r.jsx)("option",{value:"allergist",children:"Allergist"}),Object(r.jsx)("option",{value:"orthodontist",children:"Orthodontist"})]}),Object(r.jsx)("br",{}),Object(r.jsx)("label",{children:"Your Name"}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{ref:n,type:"text"}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)(u.b,{to:"/",children:"Back"}),Object(r.jsx)("input",{type:"submit",onClick:a,value:"Reserve"})]})})}var D=a.a.createContext(),S=function(){return Object(c.useContext)(D)};function N(e){var t=e.children,n=Object(c.useState)(),a=Object(b.a)(n,2),s=a[0],i=a[1],u=function(e){var t=e.role;p.ref("reservations").orderByChild("specialist").equalTo(t).on("value",(function(t){var n=t.val(),r=[];for(var c in n)r.push(n[c]);r.sort((function(e,t){return e.timestamp-t.timestamp})),i({specialistInfo:e,customers:r})}))},o={specialistData:s,fetchSpecialist:function(){var e=h.currentUser.uid;p.ref("specialists/"+e).on("value",(function(e){var t=e.val();u(t)}))},fetchCustomers:u,callMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t,n,r){var c,a,s,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=h.currentUser.uid,e.next=3,p.ref("display/"+c);case 3:return a=e.sent,e.next=6,p.ref("specialists/"+c);case 6:return s=e.sent,e.next=9,p.ref("reservations/"+n);case 9:return i=e.sent,e.next=12,a.update({token:t});case 12:return e.next=14,i.update({status:"called"});case 14:return e.next=16,s.update({currentPatient:{name:r,token:t,status:"called"}});case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),startMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t){var n,r,c,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.currentUser.uid,r=new Date,e.next=4,p.ref("reservations/"+t);case 4:return c=e.sent,e.next=7,p.ref("specialists/"+n+"/currentPatient");case 7:return a=e.sent,e.next=10,c.update({status:"started",meetingStartTime:r.getTime()});case 10:return e.next=12,a.update({status:"started"});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),endMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t){var n,r,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.currentUser.uid,e.next=3,p.ref("reservations/"+t);case 3:return r=e.sent,e.next=6,p.ref("specialists/"+n+"/currentPatient");case 6:return c=e.sent,e.next=9,r.update({status:"ended"});case 9:return e.next=11,r.remove();case 11:return e.next=13,c.update({status:"",token:"",name:""});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),cancelMeeting:function(){var e=Object(d.a)(j.a.mark((function e(t,n,r){var c,a,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=h.currentUser.uid,e.next=3,p.ref("reservations/"+t);case 3:return a=e.sent,e.next=6,p.ref("specialists/"+c+"/currentPatient");case 6:return s=e.sent,e.next=9,a.update({status:"canceled"});case 9:return e.next=11,a.remove();case 11:if(r!==n){e.next=14;break}return e.next=14,s.update({status:"",token:"",name:""});case 14:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()};return Object(r.jsx)(D.Provider,{value:o,children:t})}function P(){var e=O().logOut,t=S(),n=t.fetchSpecialist,a=t.specialistData,s=t.callMeeting,i=t.startMeeting,u=t.endMeeting,o=t.cancelMeeting,l=Object(m.f)();Object(c.useEffect)((function(){n()}),[]);var b=function(){var t=Object(d.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:l.push("/"),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0.message);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}();if(!a)return Object(r.jsx)("div",{children:"Loading..."});console.log(a);var f=a.specialistInfo,h=a.specialistInfo.currentPatient;return Object(r.jsxs)("div",{className:"dashboard-container",children:[Object(r.jsx)("h1",{children:"DashBoard"}),Object(r.jsxs)("h1",{children:["Specialist : ",f.role]}),Object(r.jsxs)("p",{children:["Current patient: ",h.name]}),Object(r.jsxs)("p",{children:["Patient token: ",h.token]}),Object(r.jsxs)("p",{children:["Status: ",h.status]}),Object(r.jsx)("div",{className:"customer-container",children:a.customers.map((function(e,t){return Object(r.jsxs)("div",{className:"customer",children:[Object(r.jsx)("p",{children:e.token}),Object(r.jsx)("p",{children:e.name}),Object(r.jsx)("button",{className:0===t&&""===h.token?"allow":"restrict",onClick:function(){return s(e.token,e.reservationCode,e.name)},children:"Call"}),Object(r.jsx)("button",{className:h.token===e.token&&"called"===h.status?"allow":"restrict",onClick:function(){return i(e.reservationCode)},children:"Start meeting"}),Object(r.jsx)("button",{className:h.token===e.token&&"started"===h.status?"allow":"restrict",onClick:function(){return u(e.reservationCode)},children:"End meeting"}),Object(r.jsx)("button",{className:"cancel",onClick:function(){return o(e.reservationCode,e.token,h.token)},children:"Cancel meeting"})]},t)}))}),Object(r.jsx)("button",{onClick:b,children:"Log Out"})]})}function I(e){var t=e.queueData;return Object(r.jsx)(r.Fragment,{children:t.map((function(e,t){return Object(r.jsxs)("h1",{children:[e.desk," ----",">"," ",e.currentPatient.token]},t)}))})}function M(e){var t=e.incomingVisits;return console.log("yes"),Object(r.jsx)(r.Fragment,{children:t.map((function(e,t){return Object(r.jsx)("h1",{children:e.token},t)}))})}function T(e){var t=e.userData,n=Object(c.useState)(),a=Object(b.a)(n,2),s=a[0],i=a[1],u=Object(c.useState)(!1),o=Object(b.a)(u,2),l=o[0],f=o[1],h=S(),p=h.fetchCustomers,x=h.specialistData,O=Object(c.useState)(),v=Object(b.a)(O,2),m=v[0],g=v[1],k=Object(c.useState)(),C=Object(b.a)(k,2),y=C[0],w=C[1];if(Object(c.useEffect)((function(){(function(){var e=Object(d.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p({role:t.specialist});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(c.useEffect)((function(){x&&D()}),[x]),Object(c.useEffect)((function(){if(l){if(y<0)return g(m-1),void w(59);0===m&&0===y&&(w(0),g(10*(s-1)),f(!1));var e=setInterval((function(){w(y-1)}),1e3);return function(){return clearInterval(e)}}}),[y,l]),!x)return Object(r.jsx)("div",{className:"queue-container",children:Object(r.jsx)("h1",{children:"Loading..."})});var D=function(){var e,n=x.customers;n.forEach((function(n,r){t.reservationCode===n.reservationCode&&(e=r)})),i(e);var r=n[0].meetingStartTime;if(r){var c=new Date(r),a=new Date(c);a.setMinutes(c.getMinutes()+10);var s=(new Date).getTime();if(s>a.getTime())console.log("Time already passed, current meeting is longer than 10 minutes"),w(0),g(10*e),f(!1);else{var u=a.getTime()-s,o=Math.floor(u%36e5/6e4),l=Math.floor(u%6e4/1e3);console.log("minutes : "+o),console.log("seconds : "+l),w(l),g(o),f(!0)}}else w(0),g(10*e),f(!1)};return Object(r.jsxs)("div",{className:"queue-container",children:[Object(r.jsxs)("h1",{children:["Your're ",s+1,"th in the queue"]}),Object(r.jsx)("h1",{children:"Queue waiting time"}),l?0===s?Object(r.jsx)("p",{children:"00:00"}):Object(r.jsxs)("p",{children:[m+10*(s-1),":",y]}):Object(r.jsxs)("p",{children:[m," : ",y]})]})}function q(e){var t,n=Object(c.useState)(!1),a=Object(b.a)(n,2),s=a[0],i=a[1],u=e.match.params.id,o=C(),l=o.fetchUserData,f=o.userData,h=o.queueData,p=o.fetchIncomingVisits,x=o.loading,O=o.incomingVisits,v=o.cancelMeeting;return Object(c.useEffect)((function(){(function(){var e=Object(d.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(u);case 2:return e.next=4,p();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),!x&&h&&O?f?"ended"===f.status?Object(r.jsx)("div",{className:"customerDashboard-container",children:Object(r.jsx)("h1",{children:"A meeting has been ended, have a nice day!"})}):"canceled"===f.status?Object(r.jsx)("div",{className:"customerDashboard-container",children:Object(r.jsx)("h1",{children:"A meeting has been canceled"})}):(t=s?Object(r.jsx)(T,{userData:f}):Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("p",{children:["Hello ",f.name,", Your token : ",f.token]}),"called"===f.status&&Object(r.jsx)("p",{children:"Your turn is up, please proceede to the counter"}),"started"===f.status&&Object(r.jsx)("p",{children:"A meeting have been started"}),Object(r.jsx)("button",{onClick:function(){return v(f.reservationCode,f,f.token)},children:"Cancel visit"}),Object(r.jsxs)("div",{className:"display",children:[Object(r.jsx)("div",{className:"current-visits",children:Object(r.jsx)(I,{queueData:h})}),Object(r.jsx)("div",{className:"incoming-visits",children:Object(r.jsx)(M,{incomingVisits:O})})]})]}),Object(r.jsxs)("div",{className:"customerDashboard-container",children:[Object(r.jsx)("h1",{children:"customerDashboard"}),Object(r.jsx)("button",{onClick:function(){return i(!1)},children:"Display"}),Object(r.jsx)("button",{onClick:function(){return i(!0)},children:"Queue time"}),t]})):Object(r.jsx)("div",{className:"customerDashboard-container",children:Object(r.jsx)("h1",{children:"Page is don't exist"})}):Object(r.jsx)("div",{className:"customerDashboard-container",children:Object(r.jsx)("h1",{children:"Loading..."})})}function E(){return Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("h1",{children:"404! Page not found"})})}n(47);var A=function(){var e,t=O().currentUser;return t?e=Object(r.jsxs)(m.c,{children:[Object(r.jsx)(m.a,{exact:!0,path:"/",component:P}),Object(r.jsx)(m.a,{path:"/display/:id",component:q}),Object(r.jsx)(m.a,{path:"/reservation",component:w}),Object(r.jsx)(m.a,{component:E})]}):null===t&&(e=Object(r.jsxs)(m.c,{children:[Object(r.jsx)(m.a,{exact:!0,path:"/",component:o}),Object(r.jsx)(m.a,{path:"/signin",component:g}),Object(r.jsx)(m.a,{path:"/display/:id",component:q}),Object(r.jsx)(m.a,{path:"/reservation",component:w}),Object(r.jsx)(m.a,{component:E})]})),Object(r.jsx)("div",{className:"App",children:Object(r.jsxs)("div",{className:"main-container",children:[Object(r.jsx)("h1",{children:"Queue Management System"}),e]})})},U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,50)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))};i.a.render(Object(r.jsx)(u.a,{children:Object(r.jsx)(v,{children:Object(r.jsx)(N,{children:Object(r.jsx)(y,{children:Object(r.jsx)(A,{})})})})}),document.getElementById("root")),U()}},[[48,1,2]]]);
//# sourceMappingURL=main.d8bce308.chunk.js.map